# 實作不等分切割

計算不等分切割的breakpoints並輸出至breakpoint.csv

``` bash
/src $ python break-point.py \
    --chunk-size 500000 \
    --srcs \
        "..\build\data\phm2012\initialized\Learning_set-Bearing1_1-acc.csv" \
        "..\build\data\phm2012\initialized\Learning_set-Bearing1_2-acc.csv" \
        "..\build\data\phm2012\initialized\Learning_set-Bearing2_1-acc.csv" \
        "..\build\data\phm2012\initialized\Learning_set-Bearing2_2-acc.csv" \
        "..\build\data\phm2012\initialized\Learning_set-Bearing3_1-acc.csv" \
        "..\build\data\phm2012\initialized\Learning_set-Bearing3_2-acc.csv" \
    --dest-dir "..\build\meta\phm2012\anomaly-detection-unequal" \
    --columns "x" "y" \
    --symbol-size 132
/src $ python break-point.py \
    --chunk-size 500000 \
    --srcs \
        "..\build\data\tongtai\initialized\2017-08-17-0.35mm-working.csv" \
        "..\build\data\tongtai\initialized\2017-08-21-0.5mm-working.csv" \
        "..\build\data\tongtai\initialized\2017-08-21-0.8mm-working.csv" \
        "..\build\data\tongtai\initialized\2017-08-21-1.0mm-working.csv" \
        "..\build\data\tongtai\initialized\2017-08-21-1.55mm-working.csv" \
        "..\build\data\tongtai\initialized\2017-08-21-2.0mm-working.csv" \
        "..\build\data\tongtai\initialized\2017-08-21-3.175mm-working.csv" \
    --dest-dir "..\build\meta\tongtai\anomaly-detection-unequal" \
    --columns "x" "y" "z" \
    --symbol-size 132
```

|  | lens | sums | mean | std | minValue | maxValue | step | len(breakpoints) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| PHM - X軸振動值 | 19287040 | 24596.359 | 0.00127527909933 | 0.665357136412 | -48.148 | 44.295 | 0.007690769230769231 | 130 |
| PHM - Y軸振動值 | 19287040 | 22080.916 | 0.00114485768682 | 0.631338264369 | -47.843 | 47.849 | 0.007690769230769231 | 130 |
| 東台 - X軸振動值 | 54085189 | -5488313.18516 | -0.101475344482 | 0.00129704140238 | -0.129278688329 | -0.0899796420831 | 0.007690769230769231 | 130 |
| 東台 - Y軸振動值 | 54085189 | -6743975.6666 | -0.124691727833 | 0.000899837100814 | -0.141069527928 | -0.111484728621 | 0.007690769230769231 | 130 |
| 東台 - Z軸振動值 | 54085189 | -6699202.08069 | -0.123863893324 | 0.0113218457356 | -0.150684084261 | -0.10634859268 | 0.007690769230769231 | 130 |

套用breakpoint將x軸振動值和y軸振動值歸類為symbols

``` bash
/src $ python label.py \
    --scope phm2012 \
    --thresholds -3.5 3.0 0.05 \
    --src-breakpoint "..\build\meta\phm2012\anomaly-detection-unequal\breakpoint.csv"
/src $ python label.py \
    --scope tongtai \
    --thresholds -0.1292189 -0.0913491 0.0002913 \
    --src-breakpoint "..\build\meta\tongtai\anomaly-detection-unequal\breakpoint.csv"
```

訓練模型

``` bash
/src $ python anomaly-detection-embedding.py \
    --scope phm2012 \
    --name ad-phm-embedding-unequal-x(case-1) \
    --step-size 6 \
    --hidden-size 16 \
    --embedding-size 100 \
    --symbol-size 132 \
    --batch-size 128 \
    --layer-depth 1 \
    --dropout-rate 0.1 \
    --learning-rates \
        1   1000   0.001 \
    --sample-size 128 # must >= batch_size and will be cut to match batch_size \
    --use-column 7 # symbol_x \
    # --src ../build/models/phm2012/ad-phm-embedding-unequal-x/case-1/model \
    --dest ../build/models/phm2012/ad-phm-embedding-unequal-x/case-1/model
```

訓練參數

| # | Cell Activation | Step | Hidden | Embedding | Symbol | Batch | Depth | Dropout | Learning Rate | Max Train Accuracy | sec/epoch | Remark |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | sigmoid | 6 | 16 | 100 | 132 | 128 | 1 | 0.1 | 0.001 | 0.769689502 (347-th epoch in 350 epochs) | 91~93 | 前 90% 視為正常 |
| 2 | sigmoid | 6 | 16 | 100 | 256 | 128 | 1 | 0.1 | 0.001 | 0.671130015 (341-th epoch in 370 epochs) | 92 ~ 98 | 前 90% 視為正常 |
| 3 | sigmoid | 6 | 16 | 100 | 256 | 128 | 1 | 0.1 | 0.001 | 0.853448422 (243-th epoch in 250 epochs) | 502~212 | 前 90% 視為正常, 使用 bearing1_1 訓練 |
| 4 | sigmoid | 6 | 16 | 100 | 256 | 128 | 1 | 0.1 | 0.001 | 0.63832347 (253-th epoch in 255 epochs) | 110~113 | 前 95% 視為正常 |

繪製loss

``` bash
/src $ python visualize-loss.py \
    --srcs \
        "..\build\plots\phm2012\ad-phm-embedding-unequal-x\log.csv" \
        "..\build\plots\phm2012\ad-phm-embedding-unequal-x\log.csv" \
        "..\build\plots\phm2012\ad-phm-embedding-unequal-x\log.csv" \
    --labels \
        "train accuracy" \
        "validate accuracy" \
        "anomalous accuracy" \
    --names \
        "epochs" "train_accuracy" "validate_accuracy" "anomalous_accuracy" "elapsed_time" \
    --columns \
        "train_accuracy" \
        "validate_accuracy" \
        "anomalous_accuracy" \
    --dest "..\build\plots\phm2012\ad-phm-embedding-unequal-x\accuracy.png" \
    --x-label "Epochs" \
    --y-label "Accuracy" \
    --title "Unequal Embedding RNN Accuracy Trend" \
    --sample-size 350
```

套入東台資料測試

``` bash
python test-anomaly-detection-embedding.py --scope tongtai --name test-ad-tongtai-embedding-unequal-x(case-1) --step-size 6 --hidden-size 16 --embedding-size 100 --symbol-size 132 --batch-size 128 --layer-depth 1 --dropout-rate 0.1 --use-column 11 --src ../build/models/phm2012/ad-phm-embedding-unequal-x/case-1/model \
    --test-src ../build/data/tongtai/labeled/2017-08-17-0.35mm-working.csv \
    --batch-step 250
python test-anomaly-detection-embedding.py --scope tongtai --name test-ad-tongtai-embedding-unequal-x(case-1) --step-size 6 --hidden-size 16 --embedding-size 100 --symbol-size 132 --batch-size 128 --layer-depth 1 --dropout-rate 0.1 --use-column 11 --src ../build/models/phm2012/ad-phm-embedding-unequal-x/case-1/model \
    --test-src ../build/data/tongtai/labeled/2017-08-17-0.35mm-working.csv \
    --batch-step 1

python test-anomaly-detection-embedding.py --scope tongtai --name test-ad-tongtai-embedding-unequal-x(case-1) --step-size 6 --hidden-size 16 --embedding-size 100 --symbol-size 132 --batch-size 128 --layer-depth 1 --dropout-rate 0.1 --use-column 11 --src ../build/models/phm2012/ad-phm-embedding-unequal-x/case-1/model \
    --test-src ../build/data/tongtai/labeled/2017-08-21-0.5mm-working.csv \
    --batch-step 250
python test-anomaly-detection-embedding.py --scope tongtai --name test-ad-tongtai-embedding-unequal-x(case-1) --step-size 6 --hidden-size 16 --embedding-size 100 --symbol-size 132 --batch-size 128 --layer-depth 1 --dropout-rate 0.1 --use-column 11 --src ../build/models/phm2012/ad-phm-embedding-unequal-x/case-1/model \
    --test-src ../build/data/tongtai/labeled/2017-08-21-0.5mm-working.csv \
    --batch-step 1

python test-anomaly-detection-embedding.py --scope tongtai --name test-ad-tongtai-embedding-unequal-x(case-1) --step-size 6 --hidden-size 16 --embedding-size 100 --symbol-size 132 --batch-size 128 --layer-depth 1 --dropout-rate 0.1 --use-column 11 --src ../build/models/phm2012/ad-phm-embedding-unequal-x/case-1/model \
    --test-src ../build/data/tongtai/labeled/2017-08-21-0.8mm-working.csv \
    --batch-step 250
python test-anomaly-detection-embedding.py --scope tongtai --name test-ad-tongtai-embedding-unequal-x(case-1) --step-size 6 --hidden-size 16 --embedding-size 100 --symbol-size 132 --batch-size 128 --layer-depth 1 --dropout-rate 0.1 --use-column 11 --src ../build/models/phm2012/ad-phm-embedding-unequal-x/case-1/model \
    --test-src ../build/data/tongtai/labeled/2017-08-21-0.8mm-working.csv \
    --batch-step 1

python test-anomaly-detection-embedding.py --scope tongtai --name test-ad-tongtai-embedding-unequal-x(case-1) --step-size 6 --hidden-size 16 --embedding-size 100 --symbol-size 132 --batch-size 128 --layer-depth 1 --dropout-rate 0.1 --use-column 11 --src ../build/models/phm2012/ad-phm-embedding-unequal-x/case-1/model \
    --test-src ../build/data/tongtai/labeled/2017-08-21-1.0mm-working.csv \
    --batch-step 250
python test-anomaly-detection-embedding.py --scope tongtai --name test-ad-tongtai-embedding-unequal-x(case-1) --step-size 6 --hidden-size 16 --embedding-size 100 --symbol-size 132 --batch-size 128 --layer-depth 1 --dropout-rate 0.1 --use-column 11 --src ../build/models/phm2012/ad-phm-embedding-unequal-x/case-1/model \
    --test-src ../build/data/tongtai/labeled/2017-08-21-1.0mm-working.csv \
    --batch-step 1

python test-anomaly-detection-embedding.py --scope tongtai --name test-ad-tongtai-embedding-unequal-x(case-1) --step-size 6 --hidden-size 16 --embedding-size 100 --symbol-size 132 --batch-size 128 --layer-depth 1 --dropout-rate 0.1 --use-column 11 --src ../build/models/phm2012/ad-phm-embedding-unequal-x/case-1/model \
    --test-src ../build/data/tongtai/labeled/2017-08-21-1.55mm-working.csv \
    --batch-step 250
python test-anomaly-detection-embedding.py --scope tongtai --name test-ad-tongtai-embedding-unequal-x(case-1) --step-size 6 --hidden-size 16 --embedding-size 100 --symbol-size 132 --batch-size 128 --layer-depth 1 --dropout-rate 0.1 --use-column 11 --src ../build/models/phm2012/ad-phm-embedding-unequal-x/case-1/model \
    --test-src ../build/data/tongtai/labeled/2017-08-21-1.55mm-working.csv \
    --batch-step 1

python test-anomaly-detection-embedding.py --scope tongtai --name test-ad-tongtai-embedding-unequal-x(case-1) --step-size 6 --hidden-size 16 --embedding-size 100 --symbol-size 132 --batch-size 128 --layer-depth 1 --dropout-rate 0.1 --use-column 11 --src ../build/models/phm2012/ad-phm-embedding-unequal-x/case-1/model \
    --test-src ../build/data/tongtai/labeled/2017-08-21-2.0mm-working.csv \
    --batch-step 250
python test-anomaly-detection-embedding.py --scope tongtai --name test-ad-tongtai-embedding-unequal-x(case-1) --step-size 6 --hidden-size 16 --embedding-size 100 --symbol-size 132 --batch-size 128 --layer-depth 1 --dropout-rate 0.1 --use-column 11 --src ../build/models/phm2012/ad-phm-embedding-unequal-x/case-1/model \
    --test-src ../build/data/tongtai/labeled/2017-08-21-2.0mm-working.csv \
    --batch-step 1

python test-anomaly-detection-embedding.py --scope tongtai --name test-ad-tongtai-embedding-unequal-x(case-1) --step-size 6 --hidden-size 16 --embedding-size 100 --symbol-size 132 --batch-size 128 --layer-depth 1 --dropout-rate 0.1 --use-column 11 --src ../build/models/phm2012/ad-phm-embedding-unequal-x/case-1/model \
    --test-src ../build/data/tongtai/labeled/2017-08-21-3.175mm-working.csv \
    --batch-step 250
python test-anomaly-detection-embedding.py --scope tongtai --name test-ad-tongtai-embedding-unequal-x(case-1) --step-size 6 --hidden-size 16 --embedding-size 100 --symbol-size 132 --batch-size 128 --layer-depth 1 --dropout-rate 0.1 --use-column 11 --src ../build/models/phm2012/ad-phm-embedding-unequal-x/case-1/model \
    --test-src ../build/data/tongtai/labeled/2017-08-21-3.175mm-working.csv \
    --batch-step 1
```

畫出原始資料

```
python visualize-column.py --srcs "..\build\data\tongtai\initialized\2017-08-17-0.35mm-working.csv" --columns "datetime" "x" --labels "x_acc" --dest "..\build\plots\tongtai\feature-observation\2017-08-17-0.35mm-working\x.png" --x-label "Time (ms)" --y-label "Acceleration (g)" --title "Acceleration Trend"
python visualize-column.py --srcs "..\build\data\tongtai\initialized\2017-08-21-0.5mm-working.csv" --columns "datetime" "x" --labels "x_acc" --dest "..\build\plots\tongtai\feature-observation\2017-08-21-0.5mm-working\x.png" --x-label "Time (ms)" --y-label "Acceleration (g)" --title "Acceleration Trend"
python visualize-column.py --srcs "..\build\data\tongtai\initialized\2017-08-21-0.8mm-working.csv" --columns "datetime" "x" --labels "x_acc" --dest "..\build\plots\tongtai\feature-observation\2017-2017-08-21-0.8mm-working\x.png" --x-label "Time (ms)" --y-label "Acceleration (g)" --title "Acceleration Trend"
python visualize-column.py --srcs "..\build\data\tongtai\initialized\2017-08-21-1.0mm-working.csv" --columns "datetime" "x" --labels "x_acc" --dest "..\build\plots\tongtai\feature-observation\2017-08-21-1.0mm-working\x.png" --x-label "Time (ms)" --y-label "Acceleration (g)" --title "Acceleration Trend"
python visualize-column.py --srcs "..\build\data\tongtai\initialized\2017-08-21-1.55mm-working.csv" --columns "datetime" "x" --labels "x_acc" --dest "..\build\plots\tongtai\feature-observation\2017-08-21-1.55mm-working\x.png" --x-label "Time (ms)" --y-label "Acceleration (g)" --title "Acceleration Trend"
python visualize-column.py --srcs "..\build\data\tongtai\initialized\2017-08-21-2.0mm-working.csv" --columns "datetime" "x" --labels "x_acc" --dest "..\build\plots\tongtai\feature-observation\2017-08-21-2.0mm-working\x.png" --x-label "Time (ms)" --y-label "Acceleration (g)" --title "Acceleration Trend"
python visualize-column.py --srcs "..\build\data\tongtai\initialized\2017-08-21-3.175mm-working.csv" --columns "datetime" "x" --labels "x_acc" --dest "..\build\plots\tongtai\feature-observation\2017-08-21-3.175mm-working\x.png" --x-label "Time (ms)" --y-label "Acceleration (g)" --title "Acceleration Trend"
```
