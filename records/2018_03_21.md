# 實作Global K-means

從feature-extracted資料依照機率分布計算breakpoints

``` bash
python break-point.py --chunk-size 500000 --srcs "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_2-acc.csv" --dest-dir "..\build\meta\phm2012\breakpoints-from-feature" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --symbol-size 8
python break-point.py --chunk-size 500000 --srcs "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_2-acc.csv" --dest-dir "..\build\meta\phm2012\breakpoints-from-feature" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --symbol-size 16
python break-point.py --chunk-size 500000 --srcs "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_2-acc.csv" --dest-dir "..\build\meta\phm2012\breakpoints-from-feature" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --symbol-size 32
python break-point.py --chunk-size 500000 --srcs "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_2-acc.csv" --dest-dir "..\build\meta\phm2012\breakpoints-from-feature" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --symbol-size 64
python break-point.py --chunk-size 500000 --srcs "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_2-acc.csv" --dest-dir "..\build\meta\phm2012\breakpoints-from-feature" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --symbol-size 128
python break-point.py --chunk-size 500000 --srcs "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_2-acc.csv" --dest-dir "..\build\meta\phm2012\breakpoints-from-feature" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --symbol-size 256
python break-point.py --chunk-size 500000 --srcs "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_2-acc.csv" --dest-dir "..\build\meta\phm2012\breakpoints-from-feature" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --symbol-size 512

```

利用breakpoints計算初始centroids，對所有資料執行global的K-means，由機器學習的方式計算出新的centroids

``` bash
python centroids.py --srcs "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_2-acc.csv" --dest-dir "..\build\meta\phm2012\centroids" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --src-breakpoint "../build/meta/phm2012/breakpoints-from-feature/breakpoint-8.csv" --symbol-size 8
python centroids.py --srcs "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_2-acc.csv" --dest-dir "..\build\meta\phm2012\centroids" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --src-breakpoint "../build/meta/phm2012/breakpoints-from-feature/breakpoint-16.csv" --symbol-size 16
python centroids.py --srcs "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_2-acc.csv" --dest-dir "..\build\meta\phm2012\centroids" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --src-breakpoint "../build/meta/phm2012/breakpoints-from-feature/breakpoint-32.csv" --symbol-size 32
python centroids.py --srcs "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_2-acc.csv" --dest-dir "..\build\meta\phm2012\centroids" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --src-breakpoint "../build/meta/phm2012/breakpoints-from-feature/breakpoint-64.csv" --symbol-size 64
python centroids.py --srcs "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_2-acc.csv" --dest-dir "..\build\meta\phm2012\centroids" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --src-breakpoint "../build/meta/phm2012/breakpoints-from-feature/breakpoint-128.csv" --symbol-size 128
python centroids.py --srcs "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_2-acc.csv" --dest-dir "..\build\meta\phm2012\centroids" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --src-breakpoint "../build/meta/phm2012/breakpoints-from-feature/breakpoint-256.csv" --symbol-size 256
python centroids.py --srcs "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing1_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing2_2-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_1-acc.csv" "..\build\data\phm2012\feature-extracted\Learning_set-Bearing3_2-acc.csv" --dest-dir "..\build\meta\phm2012\centroids" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --src-breakpoint "../build/meta/phm2012/breakpoints-from-feature/breakpoint-512.csv" --symbol-size 512

```

由學習來的centroids計算level

``` bash
python extract-kmeans-level.py --srcs "../build/data/phm2012/feature-extracted/Learning_set-Bearing1_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing1_2-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing2_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing2_2-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing3_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing3_2-acc.csv" --dests "../build/data/phm2012/feature-8-klevel-extracted/Learning_set-Bearing1_1-acc.csv" "../build/data/phm2012/feature-8-klevel-extracted/Learning_set-Bearing1_2-acc.csv" "../build/data/phm2012/feature-8-klevel-extracted/Learning_set-Bearing2_1-acc.csv" "../build/data/phm2012/feature-8-klevel-extracted/Learning_set-Bearing2_2-acc.csv" "../build/data/phm2012/feature-8-klevel-extracted/Learning_set-Bearing3_1-acc.csv" "../build/data/phm2012/feature-8-klevel-extracted/Learning_set-Bearing3_2-acc.csv" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --src-centroid "..\build\meta\phm2012\centroids\centroid-8.csv"
python extract-kmeans-level.py --srcs "../build/data/phm2012/feature-extracted/Learning_set-Bearing1_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing1_2-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing2_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing2_2-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing3_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing3_2-acc.csv" --dests "../build/data/phm2012/feature-16-klevel-extracted/Learning_set-Bearing1_1-acc.csv" "../build/data/phm2012/feature-16-klevel-extracted/Learning_set-Bearing1_2-acc.csv" "../build/data/phm2012/feature-16-klevel-extracted/Learning_set-Bearing2_1-acc.csv" "../build/data/phm2012/feature-16-klevel-extracted/Learning_set-Bearing2_2-acc.csv" "../build/data/phm2012/feature-16-klevel-extracted/Learning_set-Bearing3_1-acc.csv" "../build/data/phm2012/feature-16-klevel-extracted/Learning_set-Bearing3_2-acc.csv" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --src-centroid "..\build\meta\phm2012\centroids\centroid-16.csv"
python extract-kmeans-level.py --srcs "../build/data/phm2012/feature-extracted/Learning_set-Bearing1_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing1_2-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing2_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing2_2-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing3_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing3_2-acc.csv" --dests "../build/data/phm2012/feature-32-klevel-extracted/Learning_set-Bearing1_1-acc.csv" "../build/data/phm2012/feature-32-klevel-extracted/Learning_set-Bearing1_2-acc.csv" "../build/data/phm2012/feature-32-klevel-extracted/Learning_set-Bearing2_1-acc.csv" "../build/data/phm2012/feature-32-klevel-extracted/Learning_set-Bearing2_2-acc.csv" "../build/data/phm2012/feature-32-klevel-extracted/Learning_set-Bearing3_1-acc.csv" "../build/data/phm2012/feature-32-klevel-extracted/Learning_set-Bearing3_2-acc.csv" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --src-centroid "..\build\meta\phm2012\centroids\centroid-32.csv"
python extract-kmeans-level.py --srcs "../build/data/phm2012/feature-extracted/Learning_set-Bearing1_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing1_2-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing2_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing2_2-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing3_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing3_2-acc.csv" --dests "../build/data/phm2012/feature-64-klevel-extracted/Learning_set-Bearing1_1-acc.csv" "../build/data/phm2012/feature-64-klevel-extracted/Learning_set-Bearing1_2-acc.csv" "../build/data/phm2012/feature-64-klevel-extracted/Learning_set-Bearing2_1-acc.csv" "../build/data/phm2012/feature-64-klevel-extracted/Learning_set-Bearing2_2-acc.csv" "../build/data/phm2012/feature-64-klevel-extracted/Learning_set-Bearing3_1-acc.csv" "../build/data/phm2012/feature-64-klevel-extracted/Learning_set-Bearing3_2-acc.csv" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --src-centroid "..\build\meta\phm2012\centroids\centroid-64.csv"
python extract-kmeans-level.py --srcs "../build/data/phm2012/feature-extracted/Learning_set-Bearing1_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing1_2-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing2_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing2_2-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing3_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing3_2-acc.csv" --dests "../build/data/phm2012/feature-128-klevel-extracted/Learning_set-Bearing1_1-acc.csv" "../build/data/phm2012/feature-128-klevel-extracted/Learning_set-Bearing1_2-acc.csv" "../build/data/phm2012/feature-128-klevel-extracted/Learning_set-Bearing2_1-acc.csv" "../build/data/phm2012/feature-128-klevel-extracted/Learning_set-Bearing2_2-acc.csv" "../build/data/phm2012/feature-128-klevel-extracted/Learning_set-Bearing3_1-acc.csv" "../build/data/phm2012/feature-128-klevel-extracted/Learning_set-Bearing3_2-acc.csv" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --src-centroid "..\build\meta\phm2012\centroids\centroid-128.csv"
python extract-kmeans-level.py --srcs "../build/data/phm2012/feature-extracted/Learning_set-Bearing1_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing1_2-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing2_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing2_2-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing3_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing3_2-acc.csv" --dests "../build/data/phm2012/feature-256-klevel-extracted/Learning_set-Bearing1_1-acc.csv" "../build/data/phm2012/feature-256-klevel-extracted/Learning_set-Bearing1_2-acc.csv" "../build/data/phm2012/feature-256-klevel-extracted/Learning_set-Bearing2_1-acc.csv" "../build/data/phm2012/feature-256-klevel-extracted/Learning_set-Bearing2_2-acc.csv" "../build/data/phm2012/feature-256-klevel-extracted/Learning_set-Bearing3_1-acc.csv" "../build/data/phm2012/feature-256-klevel-extracted/Learning_set-Bearing3_2-acc.csv" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --src-centroid "..\build\meta\phm2012\centroids\centroid-256.csv"
python extract-kmeans-level.py --srcs "../build/data/phm2012/feature-extracted/Learning_set-Bearing1_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing1_2-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing2_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing2_2-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing3_1-acc.csv" "../build/data/phm2012/feature-extracted/Learning_set-Bearing3_2-acc.csv" --dests "../build/data/phm2012/feature-512-klevel-extracted/Learning_set-Bearing1_1-acc.csv" "../build/data/phm2012/feature-512-klevel-extracted/Learning_set-Bearing1_2-acc.csv" "../build/data/phm2012/feature-512-klevel-extracted/Learning_set-Bearing2_1-acc.csv" "../build/data/phm2012/feature-512-klevel-extracted/Learning_set-Bearing2_2-acc.csv" "../build/data/phm2012/feature-512-klevel-extracted/Learning_set-Bearing3_1-acc.csv" "../build/data/phm2012/feature-512-klevel-extracted/Learning_set-Bearing3_2-acc.csv" --columns "avg" "fft1" "fft2" "max" "min" "paa" "normalized_fft1" "normalized_paa" --src-centroid "..\build\meta\phm2012\centroids\centroid-512.csv"

```

訓練模型

```bash
python classification-anomaly-detection.py \
    --scope phm2012 \
    --name phm-kmeans-normalized-fft1-classification-128 \
    --step-size 32 \
    --hidden-size 64 \
    --embedding-size 128 \
    --symbol-size 128 \
    --batch-size 128 \
    --layer-depth 2 \
    --dropout-rate 0.1 \
    --learning-rates \
        1 500 0.001 \
    --sample-size 128 \
    --srcs \
        "../build/data/phm2012/feature-128-klevel-extracted/Learning_set-Bearing1_1-acc.csv" \
        "../build/data/phm2012/feature-128-klevel-extracted/Learning_set-Bearing2_1-acc.csv" \
        "../build/data/phm2012/feature-128-klevel-extracted/Learning_set-Bearing3_1-acc.csv" \
    --columns \
        "klevel_normalized_fft1" "anomaly" \
    --src-centroid "../build/meta/phm2012/centroids/centroid-128.csv" \
    --dest "../build/models/phm2012/phm-kmeans-normalized-fft1-classification-128/model"
```
